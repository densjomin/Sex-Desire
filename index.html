<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>18+ –†—É–ª–µ—Ç–∫–∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
  <style>
    :root {
      --bg: #050510;
      --wheel-man: #4a90e2;
      --wheel-woman: #ff69b4;
      --wheel-mutual: #f59e0b;
      --text: #f7f7f7;
      --card: #151522;
      --warning: #ff4444;
      --success: #4ade80;
      --accent: #a855f7;
      --skip: #4b5563; /* –°–µ—Ä—ã–π –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ–ø—É—Å–∫–∞ */
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      background: radial-gradient(circle at top, #221133 0, #050510 70%);
      color: var(--text);
      font-family: system-ui, -apple-system, sans-serif;
      overflow-x: hidden;
      user-select: none;
      -webkit-user-select: none;
    }

    .main-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      height: 100vh;
      padding: 12px;
      gap: 12px;
    }

    /* –ö–∞—Ä—Ç–æ—á–∫–∞ —Å –∑–∞–¥–∞–Ω–∏–µ–º */
    .result-card {
      background: var(--card);
      border-radius: 20px;
      padding: 0;
      border: 1px solid rgba(255, 255, 255, 0.1);
      width: 100%;
      flex: 1; 
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      position: relative;
      transition: all 0.3s ease;
      margin-bottom: 20px; /* –û—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É –¥–ª—è –º–æ–±–∏–ª–æ–∫ */
    }

    .gif-wrapper {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.2);
      flex-direction: column;
    }

    .gif-wrapper img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 20px;
    }

    /* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
    .controls-wrapper {
      width: 100%;
      max-width: 500px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding-bottom: env(safe-area-inset-bottom, 20px);
    }

    .level-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      gap: 12px;
    }

    .level-title {
      background: var(--accent);
      color: white;
      padding: 10px 16px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 15px;
      flex: 1;
      text-align: center;
      box-shadow: 0 4px 12px rgba(168, 85, 247, 0.3);
    }

    .next-level-btn {
      background: var(--success);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
      white-space: nowrap;
      box-shadow: 0 4px 12px rgba(74, 222, 128, 0.3);
      outline: none; 
    }

    .next-level-btn:active { transform: scale(0.95); }

    /* –°–µ–∫—Ü–∏—è –∫–æ–ª–µ—Å–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
    .wheel-section {
      display: flex;
      align-items: flex-end; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ –Ω–∏–∑—É */
      justify-content: space-between;
      gap: 16px;
      width: 100%;
      background: rgba(255,255,255,0.05);
      padding: 12px;
      border-radius: 20px;
    }

    /* –õ–µ–≤–∞—è —á–∞—Å—Ç—å (—Å—á–µ—Ç—á–∏–∫, —Ç–∞–π–º–µ—Ä, –ø—Ä–æ–ø—É—Å–∫) */
    .left-controls {
        display: flex;
        flex-direction: column;
        gap: 8px;
        flex: 1;
        align-items: flex-start;
        justify-content: flex-end;
    }

    .task-counter {
      font-size: 14px;
      font-weight: 600;
      color: #aaa;
    }
    .task-counter span { color: #fff; font-size: 16px; }

    /* –¢–ê–ô–ú–ï–† */
    .timer-display {
        font-family: monospace;
        font-size: 24px;
        font-weight: bold;
        color: #fff;
        text-shadow: 0 0 10px rgba(255,255,255,0.3);
        min-height: 29px;
    }
    .timer-display.alert { color: var(--warning); animation: pulse 1s infinite; }

    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
    }

    /* –ö–ù–û–ü–ö–ê –ü–†–û–ü–£–°–¢–ò–¢–¨ */
    .skip-btn {
        background: transparent;
        border: 2px solid #555;
        color: #888;
        padding: 8px 16px;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        font-size: 13px;
        transition: all 0.2s;
        text-transform: uppercase;
        width: 100%;
        max-width: 140px;
        outline: none;
    }

    .skip-btn:hover {
        border-color: #777;
        color: #fff;
        background: rgba(255,255,255,0.05);
    }
    .skip-btn:active { transform: scale(0.95); }
    
    /* –ö–æ–≥–¥–∞ –∫–Ω–æ–ø–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ */
    .skip-btn:disabled {
        opacity: 0.3;
        pointer-events: none;
        border-color: #333;
    }

    /* –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å (–ö–æ–ª–µ—Å–æ) */
    .wheel-wrapper-right {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
    }

    .wheel-container {
      width: 80px;
      height: 80px;
      cursor: pointer;
      transition: opacity 0.3s ease;
      position: relative;
    }

    .wheel-container:active { transform: scale(0.95); }
    .wheel-container.disabled { opacity: 0.4; pointer-events: none; }

    .wheel {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 3px solid #333;
      position: relative;
      transition: transform 2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    }

    .wheel.man { background: var(--wheel-man); box-shadow: 0 0 15px var(--wheel-man); }
    .wheel.woman { background: var(--wheel-woman); box-shadow: 0 0 15px var(--wheel-woman); }
    .wheel.mutual { background: var(--wheel-mutual); box-shadow: 0 0 15px var(--wheel-mutual); }

    .gender-icon {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      font-size: 32px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }
    .gender-icon.mutual { font-size: 20px; white-space: pre; line-height: 1; }

    .spin-hint {
        color: #fff;
        font-size: 10px;
        opacity: 0.5;
        text-align: center;
    }

    .message { color: #888; font-size: 16px; padding: 24px; text-align: center; }
    .error { color: var(--warning); font-weight: 600; }
    .loading { color: #aaa; }

    /* --- –ê–î–ê–ü–¢–ê–¶–ò–Ø –ü–û–î –ü–ö --- */
    @media (min-width: 1024px) {
      body { overflow: hidden; padding: 20px; }

      .main-content {
        max-width: 95vw;
        margin: 0 auto;
        height: 100vh;
        gap: 30px;
        justify-content: space-between;
      }

      .result-card {
        flex-grow: 1; 
        width: 100%;
        background: #000; 
        border: 1px solid #333;
        box-shadow: 0 0 50px rgba(0,0,0,0.5);
        margin-bottom: 60px; /* –û—Ç—Å—Ç—É–ø –Ω–∞ –ü–ö */
      }

      .controls-wrapper {
        max-width: 800px;
        background: var(--card);
        padding: 20px 40px;
        border-radius: 24px;
        border: 1px solid rgba(255,255,255,0.1);
        box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        flex-direction: row; 
        align-items: center;
      }

      .level-header { width: auto; flex: 1; }
      
      .wheel-section {
        width: auto;
        background: transparent;
        padding: 0;
        border-radius: 0;
        gap: 40px;
        flex: 1;
        justify-content: flex-end;
      }

      .left-controls {
          align-items: flex-end; /* –ù–∞ –ü–ö –ø—Ä–∏–∂–º–µ–º —Ç–∞–π–º–µ—Ä –∫ –∫–æ–ª–µ—Å—É */
          flex: none;
      }

      .wheel-container { width: 100px; height: 100px; }
      .spin-hint { font-size: 12px; }
      
      .skip-btn { text-align: center; }
    }

    @media (max-width: 1023px) {
        .spin-hint { display: none; }
    }
  </style>
</head>
<body>

  <div class="main-content">
    <div class="result-card">
      <div class="gif-wrapper" id="gifWrapper">
        <div class="message loading">–ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–¥–∞–Ω–∏—è...</div>
      </div>
    </div>

    <div class="controls-wrapper">
      <div class="level-header">
        <div class="level-title" id="levelTitle">–ü—Ä–µ–ª—é–¥–∏—è</div>
        <button class="next-level-btn" id="nextLevelBtn" title="–°—Ç—Ä–µ–ª–∫–∞ –í–ø—Ä–∞–≤–æ">–î–∞–ª—å—à–µ (‚Üí)</button>
      </div>

      <div class="wheel-section">
        <div class="left-controls">
            <div class="task-counter" id="taskCounter">
                <div><span id="taskCount">0</span> / <span id="totalTasks">?</span></div>
            </div>
            
            <div id="timerDisplay" class="timer-display">--:--</div>

            <button class="skip-btn" id="skipBtn" disabled title="Enter">–ü–†–û–ü–£–°–¢–ò–¢–¨</button>
        </div>

        <div class="wheel-wrapper-right">
            <div class="spin-hint">–ü—Ä–æ–±–µ–ª - –ö—Ä—É—Ç–∏—Ç—å</div>
            <div class="wheel-container" id="wheelContainer" title="–ü—Ä–æ–±–µ–ª">
              <div id="wheel" class="wheel man">
                <div class="gender-icon" id="genderIcon">üôé‚Äç‚ôÇÔ∏è</div>
              </div>
            </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const LEVELS = [
      { name: '–í–æ–∑–±—É–∂–¥–µ–Ω–∏–µ', type: 'separate', files: ['Level_1_Arousal_Man.json', 'Level_1_Arousal_Woman.json'] },
      { name: '–í–∑–∞–∏–º–Ω—ã–π –ñ–∞—Ä', type: 'mutual', file: 'Level_2_Mutual_Heat.json' },
      { name: '–ë–ª–∏–∑–æ—Å—Ç—å', type: 'separate', files: ['Level_3_Intimacy_Man.json', 'Level_3_Intimacy_Woman.json'] },
      { name: '–ì–æ–ª—ã–π –ñ–∞—Ä', type: 'mutual', file: 'Level_4_Bare_Heat.json' },
      { name: '–°–µ–∫—Å', type: 'separate', files: ['Level_5_Sex_Man.json', 'Level_5_Sex_Woman.json'] },
      { name: '–û—Ä–≥–∞–∑–º', type: 'separate', files: ['Level_6_Orgasm_Man.json', 'Level_6_Orgasm_Woman.json'] }
    ];

    let currentLevelIndex = 0;
    let currentLevel = LEVELS[0];
    let tasksData = {};
    let usedTasks = [];
    let totalTasks = 0;
    
    let isSpinning = false;
    let rotationAngle = 0;
    let isDataLoaded = false;
    let currentGenderIndex = 0; // 0 = man, 1 = woman
    let currentTask = null; // –¢–µ–∫—É—â–µ–µ –∞–∫—Ç–∏–≤–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ

    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–π–º–µ—Ä–∞
    let timerInterval = null;
    let isTimerRunning = false;

    // –ó–≤—É–∫–æ–≤–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –±–∏–ø–∞
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    const elements = {
      levelTitle: document.getElementById('levelTitle'),
      nextLevelBtn: document.getElementById('nextLevelBtn'),
      taskCount: document.getElementById('taskCount'),
      totalTasks: document.getElementById('totalTasks'),
      wheelContainer: document.getElementById('wheelContainer'),
      wheel: document.getElementById('wheel'),
      genderIcon: document.getElementById('genderIcon'),
      gifWrapper: document.getElementById('gifWrapper'),
      skipBtn: document.getElementById('skipBtn'),
      timerDisplay: document.getElementById('timerDisplay')
    };

    // --- –§–£–ù–ö–¶–ò–ò –ó–í–£–ö–ê ---
    function playBeep() {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(440, audioCtx.currentTime); // 440Hz
        oscillator.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.5);
        
        gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);

        oscillator.start();
        oscillator.stop(audioCtx.currentTime + 0.5);
    }

    // --- –§–£–ù–ö–¶–ò–ò –¢–ê–ô–ú–ï–†–ê ---
    function stopTimer() {
        clearInterval(timerInterval);
        elements.timerDisplay.textContent = '--:--';
        elements.timerDisplay.className = 'timer-display';
        isTimerRunning = false;
    }

    function startTimer() {
        // –ï—Å–ª–∏ —ç—Ç–æ —É—Ä–æ–≤–µ–Ω—å 6 (–û—Ä–≥–∞–∑–º), —Ç–∞–π–º–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ–º
        if (currentLevelIndex === 5) {
            elements.timerDisplay.textContent = '';
            return;
        }

        stopTimer();
        
        // –°–†–ê–ó–£ –ó–ê–ü–£–°–ö–ê–ï–ú
        // –†–∞–Ω–¥–æ–º –æ—Ç 60 –¥–æ 300 —Å–µ–∫—É–Ω–¥ (1 - 5 –º–∏–Ω—É—Ç)
        let duration = Math.floor(Math.random() * (300 - 60 + 1)) + 60;
        
        updateTimerVisual(duration);

        timerInterval = setInterval(() => {
            duration--;
            updateTimerVisual(duration);
            
            if (duration <= 0) {
                clearInterval(timerInterval);
                elements.timerDisplay.textContent = '–í–†–ï–ú–Ø!';
                elements.timerDisplay.classList.add('alert');
                playBeep();
            }
        }, 1000);
    }

    function updateTimerVisual(seconds) {
        const m = Math.floor(seconds / 60).toString().padStart(2, '0');
        const s = (seconds % 60).toString().padStart(2, '0');
        elements.timerDisplay.textContent = `${m}:${s}`;
    }

    // --- –õ–û–ì–ò–ö–ê –ò–ì–†–´ ---
    async function loadCurrentLevel() {
      stopTimer();
      elements.skipBtn.disabled = true;
      elements.gifWrapper.innerHTML = '<div class="message loading">–ó–∞–≥—Ä—É–∑–∫–∞ —É—Ä–æ–≤–Ω—è...</div>';
      
      try {
        if (currentLevel.type === 'mutual') {
          const response = await fetch(currentLevel.file);
          if (!response.ok) throw new Error(`${currentLevel.file} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
          tasksData = await response.json();
          usedTasks = [];
          totalTasks = tasksData.length;
          elements.genderIcon.textContent = 'üôé‚Äç‚ôÇÔ∏è\nüôé‚Äç‚ôÄÔ∏è';
          elements.genderIcon.className = 'gender-icon mutual';
          elements.wheel.className = 'wheel mutual';
        } else {
          const [manData, womanData] = await Promise.all([
            fetch(currentLevel.files[0]).then(r => r.json()),
            fetch(currentLevel.files[1]).then(r => r.json())
          ]);
          tasksData = { man: manData, woman: womanData };
          usedTasks = [];
          totalTasks = manData.length + womanData.length;
          
          currentGenderIndex = 0;
          elements.genderIcon.textContent = 'üôé‚Äç‚ôÇÔ∏è';
          elements.genderIcon.className = 'gender-icon';
          elements.wheel.className = 'wheel man';
        }
        
        updateCounter();
        checkGameStatus();
        return true;
      } catch (error) {
        elements.gifWrapper.innerHTML = `<div class="error message">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>`;
        return false;
      }
    }

    function nextLevel() {
      if (currentLevelIndex < LEVELS.length - 1) {
        currentLevelIndex++;
        currentLevel = LEVELS[currentLevelIndex];
        loadCurrentLevel();
      } else {
        stopTimer();
        elements.gifWrapper.innerHTML = `<div class="message">üéâ –ò–ì–†–ê –ó–ê–í–ï–†–®–ï–ù–ê! üéâ</div>`;
      }
    }

    function updateCounter() {
      elements.taskCount.textContent = usedTasks.length;
      elements.totalTasks.textContent = totalTasks;
      elements.levelTitle.textContent = currentLevel.name;
    }

    function getRandomUnusedTask() {
      let availableTasks = [];
      if (currentLevel.type === 'mutual') {
        availableTasks = tasksData.filter(task => !usedTasks.includes(task));
      } else {
        const gender = currentGenderIndex === 0 ? 'man' : 'woman';
        availableTasks = tasksData[gender].filter(task => !usedTasks.includes(task));
      }
      
      if (availableTasks.length === 0) return null;
      
      const randomIndex = Math.floor(Math.random() * availableTasks.length);
      const selectedTask = availableTasks[randomIndex];
      
      // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ
      usedTasks.push(selectedTask);
      currentTask = selectedTask;
      
      // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –ø–æ–ª –î–õ–Ø –°–õ–ï–î–£–Æ–©–ï–ì–û –•–û–î–ê (–Ω–æ —ç—Ç–æ –º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –∫–Ω–æ–ø–∫–æ–π –ø—Ä–æ–ø—É—Å–∫)
      if (currentLevel.type !== 'mutual') {
        currentGenderIndex = (currentGenderIndex + 1) % 2;
      }
      
      updateCounter();
      return selectedTask;
    }

    // --- –õ–û–ì–ò–ö–ê –ü–†–û–ü–£–°–ö–ê ---
    function skipTask() {
        if (isSpinning || elements.skipBtn.disabled) return;

        stopTimer(); // –°–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–∞

        // 1. –£–±–∏—Ä–∞–µ–º –∑–∞–¥–∞–Ω–∏–µ –∏–∑ "–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö", —á—Ç–æ–±—ã —Å—á–µ—Ç—á–∏–∫ –Ω–µ —Å—á–∏—Ç–∞–ª –µ–≥–æ
        // (–ú—ã —É–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ)
        usedTasks.pop();
        currentTask = null;

        // 2. –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º –æ—á–µ—Ä–µ–¥—å —Ö–æ–¥–∞ –æ–±—Ä–∞—Ç–Ω–æ
        // –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –≤–∑–∞–∏–º–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ö–æ–¥ —Ç–æ–º—É, –∫—Ç–æ —Ç–æ–ª—å–∫–æ —á—Ç–æ –∫—Ä—É—Ç–∏–ª
        if (currentLevel.type !== 'mutual') {
            // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –∏–Ω–¥–µ–∫—Å –æ–±—Ä–∞—Ç–Ω–æ
            currentGenderIndex = (currentGenderIndex + 1) % 2; 
            
            // –í–∏–∑—É–∞–ª—å–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–∫–æ–Ω–∫—É –∏ —Ü–≤–µ—Ç
            const isMan = currentGenderIndex === 0;
            elements.genderIcon.textContent = isMan ? 'üôé‚Äç‚ôÇÔ∏è' : 'üôé‚Äç‚ôÄÔ∏è';
            elements.wheel.className = isMan ? 'wheel man' : 'wheel woman';
        }

        updateCounter();

        // 3. –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–æ–ø—É—Å–∫–∞ –∏ –≥–æ–≤–æ—Ä–∏–º –∫—Ä—É—Ç–∏—Ç—å —Å–Ω–æ–≤–∞
        elements.skipBtn.disabled = true;
        elements.gifWrapper.innerHTML = `
            <div class="message">
                üö´ –ó–∞–¥–∞–Ω–∏–µ –ø—Ä–æ–ø—É—â–µ–Ω–æ.<br>
                –ö—Ä—É—Ç–∏ —Å–Ω–æ–≤–∞!
            </div>
        `;
    }

    function checkGameStatus() {
      if (!hasAvailableTasks()) {
        elements.wheelContainer.classList.add('disabled');
        elements.gifWrapper.innerHTML = `
          <div class="message">
            ‚úÖ –£—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–π–¥–µ–Ω!<br>
            <button class="next-level-btn" onclick="nextLevel()" style="margin-top:20px;">
              –°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å (‚Üí)
            </button>
          </div>
        `;
        return false;
      }
      elements.wheelContainer.classList.remove('disabled');
      return true;
    }

    function hasAvailableTasks() { return usedTasks.length < totalTasks; }

    function showGif(taskUrl) {
      elements.gifWrapper.innerHTML = '<div class="message loading">...</div>';
      const img = new Image();
      img.onload = () => {
        elements.gifWrapper.innerHTML = '';
        elements.gifWrapper.appendChild(img);
        checkGameStatus();
        
        // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–æ–ø—É—Å–∫–∞ –∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –°–†–ê–ó–£
        elements.skipBtn.disabled = false;
        startTimer();
      };
      img.onerror = () => {
        elements.gifWrapper.innerHTML = '<div class="error message">–û—à–∏–±–∫–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∏</div>';
        elements.skipBtn.disabled = true;
      };
      img.src = taskUrl;
    }

    function spinWheel() {
      if (isSpinning || elements.wheelContainer.classList.contains('disabled') || !isDataLoaded) return;
      
      stopTimer(); // –°–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–∞ –ø—Ä–∏ –Ω–æ–≤–æ–º –≤—Ä–∞—â–µ–Ω–∏–∏
      elements.skipBtn.disabled = true; // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø—Ä–æ–ø—É—Å–∫ –≤–æ –≤—Ä–µ–º—è –≤—Ä–∞—â–µ–Ω–∏—è
      isSpinning = true;
      
      const spinAmount = 1800 + Math.random() * 720;
      rotationAngle += spinAmount;
      elements.wheel.style.transform = `rotate(${rotationAngle}deg)`;

      setTimeout(() => {
        isSpinning = false;
        
        const taskUrl = getRandomUnusedTask();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ –ø–æ–ª –¥–ª—è –°–õ–ï–î–£–Æ–©–ï–ì–û, –∫—Ç–æ –±—É–¥–µ—Ç –∫—Ä—É—Ç–∏—Ç—å –ü–û–°–õ–ï –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
        if (currentLevel.type !== 'mutual') {
          const isNextMan = currentGenderIndex === 0;
          elements.genderIcon.textContent = isNextMan ? 'üôé‚Äç‚ôÇÔ∏è' : 'üôé‚Äç‚ôÄÔ∏è';
          elements.wheel.className = isNextMan ? 'wheel man' : 'wheel woman';
        }
        
        if (taskUrl) showGif(taskUrl);
        else checkGameStatus();
        
      }, 2000);
    }

    async function initGame() {
      isDataLoaded = await loadCurrentLevel();
    }

    // --- EVENT LISTENERS ---

    elements.wheelContainer.onclick = spinWheel;
    elements.wheelContainer.ontouchstart = (e) => { e.preventDefault(); spinWheel(); };
    elements.nextLevelBtn.onclick = nextLevel;
    
    // –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å
    elements.skipBtn.onclick = skipTask;

    document.addEventListener('keydown', (event) => {
        if (event.code === 'Space') {
            event.preventDefault(); 
            spinWheel();
        }
        if (event.code === 'ArrowRight') {
            nextLevel();
        }
        // Enter –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞
        if (event.code === 'Enter') {
            event.preventDefault();
            skipTask();
        }
    });

    initGame();
  </script>
</body>
</html>
